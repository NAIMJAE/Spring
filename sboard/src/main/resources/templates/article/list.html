<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/defaultLayout.html}">
    <!--내용 시작-->
        <div class="container-fluid px-4" layout:fragment="content">
            <script>
                window.onload = function (){
                    // 현재 시간 가져오기
                    let currentDate = new Date();
                    // 모든 tdTitle 요소에 대해 반복
                    let tdTitles = document.getElementsByClassName('tdTitle');
                    for (let i = 0 ; i < tdTitles.length ; i++) {
                        const tdRdate = tdTitles[i].parentElement.querySelector('.tdRdate').getAttribute('name');

                        // tdRdate를 JavaScript의 Date 객체로 변환
                        let articleDate = new Date(tdRdate);

                        // 두 날짜의 차이를 계산하여 일(day) 단위로 변환
                        let differenceInMilliseconds = currentDate - articleDate;
                        let differenceInDays = differenceInMilliseconds / (1000 * 60 * 60 * 24);

                        // 차이가 24시간 이내인 경우 'NEW'를 추가
                        if (differenceInDays < 1) {
                            const span = `<span class="badge border-bottom rounded-pill text-bg-warning" name="badge">NEW</span>`;
                            tdTitles[i].insertAdjacentHTML('beforeend', span);
                        }
                    }
                }
            </script>
                <h1 class="mt-4 mb-4" th:if="${pageResponseDTO.condition != null}">전체 게시글</h1>
            <th:block th:if="${pageResponseDTO.condition == null}">
                <h1 class="mt-4 mb-4" th:if="${pageResponseDTO.dtoList[0].cate == 'notice'}">공지사항</h1>
                <h1 class="mt-4 mb-4" th:if="${pageResponseDTO.dtoList[0].cate == 'free'}">자유게시판</h1>
                <h1 class="mt-4 mb-4" th:if="${pageResponseDTO.dtoList[0].cate == 'faq'}">자주묻는질문</h1>
                <h1 class="mt-4 mb-4" th:if="${pageResponseDTO.dtoList[0].cate == 'qna'}">묻고답하기</h1>
            </th:block>

            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-table me-1"></i>
                    게시글 목록
                </div>
                <div class="card-body">
                    <table id="datatablesSimple" class="table table-hover">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>제목</th>
                                <th>작성자</th>
                                <th>조회수</th>
                                <th>등록일</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr th:each="article, index : ${pageResponseDTO.dtoList}">
                                <td class="col-1" th:text="${pageResponseDTO.startNo - index.index}"></td>
                                <td class="tdTitle">
                                    <a class="text-dark text-decoration-none"  style="font-weight: bold" th:href="@{/article/view(cate=${article.cate}, no=${article.no})}">
                                        [[${article.title}]]</a>
                                    <span class="badge text-bg-light border-bottom rounded-pill" th:text="${article.comment}"></span>
                                </td>
                                <td class="col-2" th:text="${pageResponseDTO.nickList[index.index]}"></td>
                                <td class="col-1" th:text="${article.hit}"></td>
                                <td class="tdRdate col-2" th:name="${article.rdate}" th:text="${#temporals.format(article.rdate, 'yyyy-MM-dd HH:mm')}"></td>
                                <!--${#strings.substring(#temporals.format(article.rdate, 'yyyy-MM-dd HH:mm'), 2, 16)} -->
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div>
                    <nav aria-label="Page navigation example">
                        <ul class="pagination justify-content-center">
                            <th:block th:if="${pageResponseDTO.prev}">
                                <li class="page-item">
                                    <a class="page-link" th:href="@{/article/list(cate=${pageResponseDTO.cate}, pg=${pageResponseDTO.start - 1})}">이전</a>
                                </li>
                            </th:block>

                            <th:block th:each="n : ${#numbers.sequence(pageResponseDTO.start, pageResponseDTO.end)}">
                                <li class="page-item" th:classappend="${pageResponseDTO.pg == n ? 'active' : ''}">
                                    <a class="page-link" th:href="@{/article/list(cate=${pageResponseDTO.cate}, pg=${n}, condition=${pageResponseDTO.condition}, searchText=${pageResponseDTO.searchText})}" th:text="${n}"></a>
                                </li>
                            </th:block>

                            <th:block th:if="${pageResponseDTO.next}">
                                <li class="page-item">
                                    <a class="page-link" th:href="@{/article/list(cate=${pageResponseDTO.cate}, pg=${pageResponseDTO.end + 1})}">다음</a>
                                </li>
                            </th:block>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="text-end">
                <a th:href="@{/article/write(cate=${pageResponseDTO.cate})}" class="btn btn-secondary">글작성</a>
            </div>
        </div>
    <!--내용 끝-->
</html>
